# Weak Encryption

## Analysis

The guide provided a Python script which detailed the cipher used to encrypt the key. The script, named "cipherspec.py", contained three distinct functions:

* **gen() -** This function is used to generate the cipher key.

```python
def gen(): 
	offset = 3 # Hotfix to make Crypto blazing fast!!
	key = bytearray(b'\x00'*(KEYLEN-offset)) 
	key.extend(os.urandom(offset))
	return bytes(key)
```

* **enc() -** A function which, given a <u>key</u>, a <u>message</u> and a <u>nonce</u>, encrypts the message using the AES cipher.
* **dec() -** A function which, given a <u>key</u>, a <u>ciphertext</u> and a <u>nonce</u>, decrypts the ciphertext according to the AES cipher.

We opted to not include the source code for the last two functions, seeing as they do not possess any vulnerabilities. In fact, the problem lies in the key generation function.

The issue is very simple: only the last three bytes of the **key** are being randomized. This is because the variable "offset", defined in the first line of the key generation function, is being used to establish how many bytes of the key should be random as seen below:

```python
key = bytearray(b'\x00'*(KEYLEN-offset)) # create a byte array with 0's
key.extend(os.urandom(offset)) # append to that array a few random bytes
```

Seeing as the value of "offset" is **3**, the key was being generated by creating an array of bytes with the value 0 and appending to that array a mere three random bytes. Since three is a very low number, this cipher was vulnerable to **brute-force** attacks, that is, we could try out every possible key to discover which one was used to encrypt the message.

To that end, we would need to create a byte array filled with 0s, which would be our key. Then, we would attempt to decrypt the message using said key. If the decrypted message was the **flag**, we could stop, otherwise we would increment the last three bytes and try again.

## Preparing the Script

To separate our code from the server's, we created a new Python file - "attack.py".


